"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateBuildInfo = void 0;
const time_lib_1 = require("@naturalcycles/time-lib");
const git_util_1 = require("./git.util");
async function generateBuildInfo(dev = false) {
    const now = (0, time_lib_1.dayjs)();
    const [rev, branchName, repoName, tsCommit] = dev
        ? ['devRev', 'devBranch', 'devRepo', now.unix()]
        : await Promise.all([
            (0, git_util_1.gitCurrentCommitSha)(),
            (0, git_util_1.gitCurrentBranchName)(),
            (0, git_util_1.gitCurrentRepoName)(),
            (0, git_util_1.gitCurrentCommitTimestamp)(),
        ]);
    const ts = now.unix();
    const tsStr = now.toPretty();
    const ver = [now.toCompactTime(), repoName, branchName, rev].join('_');
    return {
        ts,
        tsCommit,
        tsStr,
        repoName,
        branchName,
        rev,
        ver,
    };
}
exports.generateBuildInfo = generateBuildInfo;
