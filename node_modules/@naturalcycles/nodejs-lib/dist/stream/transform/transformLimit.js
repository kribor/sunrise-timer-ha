"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.transformLimit = void 0;
const stream_1 = require("stream");
/**
 * 0 or falsy value means "no limit"
 */
function transformLimit(limit, opt = {}) {
    let index = 0;
    let ended = false;
    return new stream_1.Transform({
        objectMode: true,
        ...opt,
        transform(chunk, _encoding, cb) {
            index++;
            if (!ended) {
                cb(null, chunk); // pass through the item
            }
            else {
                cb(null); // pass-through empty
            }
            if (limit && index === limit) {
                ended = true;
                console.log(`transformLimit: limit of ${limit} reached`);
                // this.emit('end') // this makes it "halt" on Node 14 lts
            }
        },
    });
}
exports.transformLimit = transformLimit;
