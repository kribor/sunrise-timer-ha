"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.pBatch = void 0;
const __1 = require("..");
const pMap_1 = require("./pMap");
/**
 * Like pMap, but doesn't fail on errors, instead returns both successful results and errors.
 */
async function pBatch(iterable, mapper, opt) {
    try {
        const results = await (0, pMap_1.pMap)(iterable, mapper, {
            ...opt,
            errorMode: __1.ErrorMode.THROW_AGGREGATED,
        });
        return {
            results,
            errors: [],
        };
    }
    catch (err) {
        const { errors, results } = err;
        if (!errors || !results)
            throw err; // not an AggregatedError
        return {
            results,
            errors,
        };
    }
}
exports.pBatch = pBatch;
